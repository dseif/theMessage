<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title></title> <!-- CHANGE THE TITLE! -->
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="css/style.css">
  <style type="text/css">
   
  </style>
  <script>
    window.parallax = function(ids, ratio, top, adjustment) {
        var i, j, elements = [],
           offset = window.pageYOffset;

        if ( typeof ids === "string") {
          elements.push( document.getElementById(ids) );
        } else {
          for(i=0; i<ids.length;i++) {
            elements.push( document.getElementById(ids[i]) );
          }
        }
        if(adjustment === undefined) {
          adjustment = 0;
        }

        for(j=0;j<elements.length;j++) {
          //Parent offset: var parentOffset = elements[j].parentNode.offsetTop;
          //elements[j].style.top = -parentOffset + adjustment + ( offset/ratio ) + "px";
          elements[j].style.top = ( adjustment + ((offset - top) /ratio) ) + "px";

        }
      };
    document.addEventListener( "DOMContentLoaded", function( event ) {

      //Title
      $("h1.title").lettering();
      var buttons = document.getElementsByClassName( "sectionButtons" );
      window.scrollToSection = function( val ) {
        var element = $( "#section-" + ( val + 1 ) );
        $.scrollTo( element, 1000 * val );
      }
       
      for ( var i = 0, l = buttons.length; i < l; i++ ) {
        (function( counter ) {
          buttons[ i ].addEventListener( "click", function( e ) {
 
            scrollToSection( counter ); 
          }, false);
        })( i );
      }

      //Section offsets, for scrolling
      //Pre-calculated for speed
      var sectionTop = [];
      sectionTop[2] = document.getElementById("section-2").offsetTop;
      sectionTop[3] = document.getElementById("section-3").offsetTop;
      sectionTop[4] = document.getElementById("section-4").offsetTop;


      $(window).scroll(function(e) {
        //SCROLLSTUFF
        var offset = window.pageYOffset;

        //TITLE
        $("#section-1 h1").css( {
          "font-size" : 5.5 + (offset/10) + "em",
          "opacity": 1 - (offset/1000)
         //,"text-shadow" : " #FFF 0 0 " + (offset/10) + "px"
        });

        //Section 2 ----------------------------------
        parallax( "pane-2-bg", 4, sectionTop[2], 900);
        //Level A - Farthest
        parallax( "pane-2-6", .8, sectionTop[2], 100);
        //Level B - Base
        parallax( "pane-2-1", 1, sectionTop[2], 300 );
        //Level C
        parallax( "pane-2-2", 1.25, sectionTop[2], 0 );
        //Level D

        parallax(  "pane-2-4", 1.5, sectionTop[2], 400 );
        parallax(  "pane-2-5", 0.9, sectionTop[2], 600 );
        parallax( "pane-2-7", 2, sectionTop[2], 150 );
        parallax( "pane-2-8", 1.5, sectionTop[2], 175 );
        parallax( "pane-2-9", 1, sectionTop[2], 100 );
        parallax( "pane-2-10", 1.5, sectionTop[2], 700 );
        parallax( "pane-2-3", 1.6, sectionTop[2], 800 );

        //Section 3 ----------------------------------
        parallax( "pane-3-1", 1, sectionTop[3], 300 );
        parallax( "pane-3-2", 1, sectionTop[3], 300 );
        parallax( ["pane-3-3", "pane-3-5"], 1.25, sectionTop[3], 500 );
        parallax(  "pane-3-4", 1.5, sectionTop[3], 300 );

        //Section 4
        parallax( "pane-4-1", 1, sectionTop[4], 300 );
        $.ajax({
          url: document.location.protocol + "//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=20&callback=?&q=" + encodeURIComponent("http://news.google.com/news?gl=ca&q=limits%2Bgrowth%2Benvironment&um=1&ie=UTF-8&output=rss"),
          dataType: 'json',
          success: function(data) {
            var entries = data.responseData.feed.entries,
                element = document.getElementById("section-4");

            for ( var i = 0, l = entries.length; i < l; i++ ) {
              var start = i * 10,
                  container = document.createElement( "div" );

              container.className = "pane";
              container.style.left = Math.floor((Math.random()* 100) + 1)  + "%";
              container.id = "paneRSS-4-" + i;
              element.appendChild( container );

              parallax( "paneRSS-4-" + i, Math.floor((Math.random()*100)+1), element.offsetTop, Math.floor((Math.random()*800)+1) );
            }
          }
        });
      //Takes a single id or an array of ids.
      //Higher ratio = slower motion, higher position on the page.
      //If you want it to start lower, increase the adjustment number

      

      if(offset === 6800) {
        p.play(10);
      }

    }); //SCROLL

      // CROWD
      var crowd = Popcorn("#crowd");
      crowd.on("canplayall", function() {
         this.play().volume(0.1);
        $(window).scroll(function(){
          var height = window.pageYOffset;
          var vol = 0.1 + height/7000;
          if (vol <= 1) {
            crowd.volume(vol);
          }
          if (window.pageYOffset > 7000) {
            var i;
            for(i=1;i<100;i++) {
              setTimeout(function() {
                crowd.volume( (100-i)/100 );
              }, 100);
            }
          }
          });
        });
            }, false);
  </script>
</head>
<body>

<div id="bg-image"></div>
<div class="wrapper">
  <div id="dev-info" style="position:fixed;bottom:40px;left:10px;background:rgba(0,0,0,.8);color:red;z-index:1000000">
    <!-- for dev: shows current scroll postiion -->
    scroll:<span id="scroll-position"></span>
    window:<span id="window-height"></span>
    doc:<span id="doc-height"></span>
  </div>

  <header>
  </header>
  <div id="main" role="main">
    <section id="section-1">
      <audio id="crowd" src="media/crowdnoise.mp3"></audio>
      <div id="worldmap">
        <img id="img3" src="img/map-10.png" />
        <img id="img2" src="img/map-5.png" />
        <img id="img1" src="img/map-dark.png" /> 
      </div>
      <div id="title-container">
        <h1 class="title">The Limits of Growth<h1>
      </div>
      <h2 class="title">Exploring the relationship between <span class="yellow">economic growth</span> and<br/> <span class="yellow">environmental sustainability</span><h2>
       <div class="buttons">
          <button class="sectionButtons" id="sec1">Section 1</button>
          <button class="sectionButtons" id="sec2">Section 2</button>
          <button class="sectionButtons" id="sec3">Section 3</button>
          <button class="sectionButtons" id="sec4">Section 4</button>
      </div>
    </section>
    <section id="section-2">
      
      <div id="pane-2-bg" class="pane-bg"><img src="img/andromeda.png"/></div>
      <div class="pane" id="pane-2-1"> 
        <div class="video-container">
  
        <video id="video" controls> 
              <source src="http://videos-origin.mozilla.org/serv/webmademovies/hothacks/message/NaomiKlein_TED%20TALK%20Excerpt2010.mp4">
              <source src="http://videos-origin.mozilla.org/serv/webmademovies/hothacks/message/NaomiKlein_TED%20TALK%20Excerpt2010.mp4.webm">
          </video>
            <p>Naomi Klein (No Logo, The Shock Doctrine) presented this TED Talk, "Addicted to Risk" in December 2010 in Washington, DC.</p>
        </div>
      </div>
      <div class="pane" id="pane-2-2">
        <div id="youtube">
        </div>
      </div>
      <div class="pane" id="pane-2-3"></div>
      <div class="pane" id="pane-2-4"><img src="img/2-map-off.png"></div>
      <div class="pane" id="pane-2-5"><img src="img/2-tree-off.png"></div>
      <div class="pane" id="pane-2-6"></div>
      <div class="pane" id="pane-2-7"></div>
      <div class="pane" id="pane-2-8"></div>
      <div class="pane" id="pane-2-9"></div>
      <div class="pane" id="pane-2-10"></div>
    </section>
    <section id="section-3">
      <div class="pane" id="pane-3-1"> 
        <video id="video2" controls data-timeline-sources="js/estella.srt"> 
              <source src="http://videos-origin.mozilla.org/serv/webmademovies/hothacks/message/James%20Delingpole%20Edits.mp4">
              <source src="http://videos-origin.mozilla.org/serv/webmademovies/hothacks/message/James%20Delingpole%20Edits.mp4.webm">
          </video>
        </div>
      </div>
      <div class="pane" id="pane-3-2">2</div>
      <div class="pane" id="pane-3-3">3</div>
      <div class="pane" id="pane-3-4">4</div>
      <div class="pane" id="pane-3-5">5</div>
      <div class="pane" id="pane-3-6">6</div>
    </section>
    <section id="section-4">
      <div class="pane" id="pane-4-1"> 
        <div class="video-container">
        <video id="video3" controls> 
              <source src="http://videos-origin.mozilla.org/serv/webmademovies/hothacks/message/James%20Delingpole%20Clip.mp4">
              <source src="http://videos-origin.mozilla.org/serv/webmademovies/hothacks/message/James%20Delingpole%20Clip.mp4.webm">
          </video>
          </div>
      </div>
      <div class="pane" id="pane-4-2">2</div>
      <div class="pane" id="pane-4-3">4</div>
      <div class="pane" id="pane-4-4">4</div>
      <div class="pane" id="pane-4-5">5</div>
      <div class="pane" id="pane-4-6">6</div>

    </section>      

  </div>
  <footer>

  </footer>
</div>
<!--<script src="http://popcornjs.org/code/dist/popcorn-complete.js"></script>-->
    <script>window.Popcorn || document.write('<script src="js/popcorn-complete.js"><\/script>')</script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.7.1.min.js"><\/script>')</script>
  <script src="js/jquery.scrollTo-min.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/jquery.scrollorama.js"></script>
  <script src="js/popcorn.supertext.js"></script>
  <script src="js/popcorn.fade.js"></script>
  <script src="js/lettering.js"></script>
  <!--
  <script src="js/stackblur.js"></script>
  <script src="js/fastblur.js"></script>
-->
  <script type="text/javascript" src="http://use.typekit.com/fph5scc.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <script src="message.js"></script>
  <script>

      $("#doc-height").text( $(document).height() );
      $("#window-height").text( $(window).height() );
      $(window).scroll(function(e) {
        var height = window.pageYOffset;
        if ( height < 1600 &&  height > 1000 ) { 
          //console.log(map(height, 1000, 1600, 40));
          //$(".parallax-container-off").css( "textShadow", "0 0 "+map(height, 1000, 1600, 40)+"px white");
        }
        
        if ( height < 600 ) { 
          //boxBlurImage("img", "canvas", (height/600) * 10);
        }
        $("#scroll-position").text( height );
      });
      $(window).resize( function(e) {
         $("#window-height").text( $(window).height() );
      });

      Popcorn.plugin.debug = true;
      var p3 = Popcorn( "#video3" ),
          p2 = Popcorn( "#video2" ),
          p = Popcorn( "#video" );

        
      p.on( "canplayall", function( e ) {
          this.on( "ended", function() {
            scrollToSection( 2 );
            p2.play( 0 );
          });
          p2.on( "ended", function() {
            scrollToSection( 3 );
            p3.play( 0 );
          });
          this
          .supertext({
            start: 20,
            end: 23,
            activeClass: "parallax-container-active",
            inactiveClass: "parallax-container-off",
            text: "Supremacy",
            target: "pane-2-2"
          })
          .supertext({
            start: 23,
            end: 25,
            activeClass: "parallax-container-active",
            inactiveClass: "parallax-container-off",
            text: "",
            target:"pane-2-3",
            callback: function() {
              var y = Popcorn.youtube("youtube", "http://www.youtube.com/watch?v=PcEto_Q8MlY&feature=youtu.be&t=2m16s");
            }
          })
          .supertext({
            start: 25,
            end: 28,
            activeClass: "parallax-container-active",
            inactiveClass: "parallax-container-off",
            text: '<img src="img/2-map-on.png">',
            target:"pane-2-4"
          })
           .fade({
            start: 1,
            end: 10,
            img1: "img/2-tree-off.png",
            img2: "img/2-tree-on.png",
            target: "pane-2-5",
            rate: 0.05
          })
          .supertext({
            start: 24,
            end: 30,
            activeClass: "parallax-container-active",
            inactiveClass: "parallax-container-off",
            text: "And it struck me that, in its own way, the bizarre ad was a crass version of our founding story—we slapped mother nature around and won. And we will always win, because dominating nature is our destiny.",
            target:"pane-2-6"
          })
          .supertext({
            start: 28,
            end: 32,
            activeClass: "parallax-container-active",
            inactiveClass: "parallax-container-off",
            text: "And it struck me that, in its own way, the bizarre ad was a crass version of our founding story—we slapped mother nature around and won. And we will always win, because dominating nature is our destiny.",
            target:"pane-2-7"
          })
          .supertext({
            start: 34,
            end: 38,
            activeClass: "parallax-container-active",
            inactiveClass: "parallax-container-off",
            text: "And it struck me that, in its own way, the bizarre ad was a crass version of our founding story—we slapped mother nature around and won. And we will always win, because dominating nature is our destiny.",
            target:"pane-2-8"
          })
          .supertext({
            start: 34,
            end: 40,
            activeClass: "parallax-container-active",
            inactiveClass: "parallax-container-off",
            text: "And it struck me that, in its own way, the bizarre ad was a crass version of our founding story—we slapped mother nature around and won. And we will always win, because dominating nature is our destiny.",
            target:"pane-2-9"
          })
          .supertext({
            start: 40,
            end: 44,
            activeClass: "parallax-container-active",
            inactiveClass: "parallax-container-off",
            text: "And it struck me that, in its own way, the bizarre ad was a crass version of our founding story—we slapped mother nature around and won. And we will always win, because dominating nature is our destiny.",
            target:"pane-2-10"
          });
          
          /*var section1 = $( "#section-2" ),
          var section1 = $( "#section-2" ),
              offsetTop = section1.offset().top,
              duration = this.duration(),
              scrollLength = section1.height() / duration,
              instance = this,
              times = [ 17, 23, 93 ],
              events = [];

        for ( var idx in times ) {
          events.push( offsetTop + ( times[ idx ] * scrollLength ) );
        }

        $(window).scroll(function(e) {
          var offset = window.pageYOffset;

          if ( offset > 620 ) {
            if ( offset > events[ 2 ] ) {
              instance.currentTime( 93 );
            } else if ( offset < events[ 2 ] && offset > events[ 1 ] ) {
              instance.currentTime( 23 );
            } else if ( offset < events[ 1 ] && offset > events[ 0 ] ) {
              instance.currentTime( 17 );
            } else {
              instance.currentTime( 0 );
            }
          }
          if ( offset > ( offsetTop + section1.height() ) ) {
            instance.pause();
          }
        });*/
      });
    </script>
  <!-- end scripts -->
</body>
</html>
